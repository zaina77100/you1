name: Grit & Gold Auto-Uploader
on:
  schedule:
    - cron: '0 */4 * * *'  # ูุนูู ูู 4 ุณุงุนุงุช ุชููุงุฆูุงู
  workflow_dispatch:  # ูุณูุญ ูู ุจุชุดุบููู ูุฏููุงู

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 30
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
      
      - name: Install Python dependencies
        run: |
          pip install --upgrade pip
          
          # ุชุซุจูุช moviepy ุฃููุงู ูุน dependencies ุงููุทููุจุฉ
          pip install numpy==1.24.0
          pip install pillow==10.2.0
          pip install imageio==2.31.5
          pip install imageio-ffmpeg==0.4.9
          pip install decorator==5.1.1
          pip install tqdm==4.66.1
          pip install proglog==0.1.10
          
          # ุชุซุจูุช moviepy
          pip install moviepy==1.0.3
          
          # ุงุฎุชุจุงุฑ moviepy
          python -c "from moviepy.editor import VideoFileClip; print('โ moviepy ูุนูู')"
          
          # ุชุซุจูุช ุจุงูู ุงูููุชุจุงุช
          pip install google-genai
          pip install google-api-python-client
          pip install google-auth-oauthlib
          pip install yt-dlp
          pip install opencv-python-headless
      
      - name: Create config from secrets
        run: |
          mkdir -p config_grit_gold
          
          # ุฅูุดุงุก ููู Gemini key
          if [ -n "$GEMINI_API_KEY" ]; then
            echo "$GEMINI_API_KEY" > config_grit_gold/gemini_key.txt
            echo "โ ุชู ุฅูุดุงุก ููู gemini_key.txt"
          else
            echo "โ๏ธ GEMINI_API_KEY ุบูุฑ ููุฌูุฏ"
          fi
          
          # ุฅูุดุงุก ููู youtube credentials
          if [ -n "$YOUTUBE_CREDENTIALS" ]; then
            echo "$YOUTUBE_CREDENTIALS" > config_grit_gold/youtube_credentials.json
            echo "โ ุชู ุฅูุดุงุก ููู youtube_credentials.json"
          else
            echo "โ๏ธ YOUTUBE_CREDENTIALS ุบูุฑ ููุฌูุฏ"
          fi
          
          # ุฅูุดุงุก ุจุงูู ุงููุฌูุฏุงุช
          mkdir -p output_grit_gold temp_grit_gold logs_grit_gold database_grit_gold
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          YOUTUBE_CREDENTIALS: ${{ secrets.YOUTUBE_CREDENTIALS }}
      
      - name: Test all imports
        run: |
          echo "๐ ุงุฎุชุจุงุฑ ุงุณุชูุฑุงุฏ ุฌููุน ุงูููุชุจุงุช..."
          python -c "
          import sys
          
          # ูุงุฆูุฉ ุงูููุชุจุงุช ุงููุทููุจุฉ
          libs = [
              ('google.genai', 'import google.genai'),
              ('googleapiclient', 'from googleapiclient.discovery import build'),
              ('yt-dlp', 'import yt_dlp'),
              ('moviepy', 'from moviepy.editor import VideoFileClip'),
              ('opencv', 'import cv2'),
              ('PIL', 'from PIL import Image'),
          ]
          
          for name, imp in libs:
              try:
                  exec(imp)
                  print(f'โ {name} - OK')
              except ImportError as e:
                  print(f'โ {name} - ุฎุทุฃ: {e}')
                  if name in ['moviepy', 'google.genai', 'yt-dlp']:
                      sys.exit(1)
          
          print('๐ ุฌููุน ุงูููุชุจุงุช ูุซุจุชุฉ ุจุดูู ุตุญูุญ!')
          "
      
      - name: Run Bot
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          YOUTUBE_CREDENTIALS: ${{ secrets.YOUTUBE_CREDENTIALS }}
        run: |
          echo "๐ ุจุฏุก ุชุดุบูู ุงูุจูุช..."
          python deepseek_python_20260127_288de0.py --auto
