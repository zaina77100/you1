name: Grit & Gold Auto-Uploader
on:
  schedule:
    - cron: '0 */4 * * *'  # ÙŠØ¹Ù…Ù„ ÙƒÙ„ 4 Ø³Ø§Ø¹Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  workflow_dispatch:  # ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg wget
          # Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù€ OpenCV
          sudo apt-get install -y libsm6 libxext6 libxrender-dev libglib2.0-0
      
      - name: Install Python dependencies
        run: |
          pip install --upgrade pip setuptools wheel
          
          # ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
          pip install numpy==1.24.0
          pip install pillow==10.2.0
          pip install imageio==2.31.5
          pip install imageio-ffmpeg==0.4.9
          
          # ØªØ«Ø¨ÙŠØª moviepy Ø£ÙˆÙ„Ø§Ù‹
          pip install moviepy==1.0.3
          
          # Ø«Ù… Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
          pip install google-genai==0.3.0
          pip install google-api-python-client==2.108.0
          pip install google-auth-oauthlib==1.1.0
          pip install yt-dlp==2023.12.30
          pip install opencv-python-headless==4.8.1.78
      
      - name: Test imports
        run: |
          echo "ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª..."
          python -c "
          import sys
          
          print('1. Ø§Ø®ØªØ¨Ø§Ø± google-genai...')
          try:
              import google.genai as genai
              print('   âœ… google.genai - OK')
          except ImportError as e:
              print(f'   âŒ Ø®Ø·Ø£: {e}')
          
          print('2. Ø§Ø®ØªØ¨Ø§Ø± moviepy...')
          try:
              from moviepy.editor import VideoFileClip, TextClip, CompositeVideoClip
              print('   âœ… moviepy.editor - OK')
          except ImportError as e:
              print(f'   âŒ Ø®Ø·Ø£: {e}')
          
          print('3. Ø§Ø®ØªØ¨Ø§Ø± yt-dlp...')
          try:
              import yt_dlp
              print('   âœ… yt-dlp - OK')
          except ImportError as e:
              print(f'   âŒ Ø®Ø·Ø£: {e}')
          
          print('4. Ø§Ø®ØªØ¨Ø§Ø± opencv...')
          try:
              import cv2
              print(f'   âœ… opencv - OK (Ø§Ù„Ø¥ØµØ¯Ø§Ø±: {cv2.__version__})')
          except ImportError as e:
              print(f'   âŒ Ø®Ø·Ø£: {e}')
          
          print('5. Ø§Ø®ØªØ¨Ø§Ø± PIL...')
          try:
              from PIL import Image
              print(f'   âœ… PIL - OK (Ø§Ù„Ø¥ØµØ¯Ø§Ø±: {Image.__version__})')
          except ImportError as e:
              print(f'   âŒ Ø®Ø·Ø£: {e}')
          
          print('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª')
          "
      
      - name: Create necessary directories
        run: |
          mkdir -p config_grit_gold output_grit_gold temp_grit_gold logs_grit_gold database_grit_gold
      
      - name: Run Bot (Single Cycle)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª..."
          python -c "
          # Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø© Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
          print('ğŸ­ Grit & Gold Factory - Test Mode')
          print('ğŸ”§ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...')
          
          import os
          import sys
          
          # Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø± Ù„Ù„ÙˆØ­Ø¯Ø§Øª
          sys.path.append('.')
          
          try:
              # Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
              print('ğŸ“¦ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙØ¦Ø§Øª...')
              exec(open('deepseek_python_20260127_288de0.py').read())
              print('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª Ø¬Ø§Ù‡Ø²Ø©')
          except Exception as e:
              print(f'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: {e}')
              import traceback
              traceback.print_exc()
          "
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
          echo "1" | python deepseek_python_20260127_288de0.py
